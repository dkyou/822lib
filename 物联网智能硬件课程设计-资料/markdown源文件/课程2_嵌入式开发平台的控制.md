课程2 嵌入式开发平台的控制
=====================

课程概述
----

在这个教程中，我们将学习如何使用树莓派GPIO控制外部LED灯的闪烁。

关于课程
----

按照规划，本课程需要花费大约45分钟来完成，目标受众为四足机器人开发爱好者。

**注意** 本课程是基于[Mangdang](https://www.mangdang.net/)的Mini Pupper系列产品搭建的。本课程涉及的源代码托管在Github，你可以[点击此处访问](https://github.com/mangdangroboticsclub/mini_pupper_ros/tree/ros2)。

学习目标
----

在完成这个教程后，你将能够：

1. 通过背景知识学习，了解四足机器人mini pupper搭载的微型控制计算机：树莓派。
2. 通过树莓派GPIO操作的学习，熟悉GPIO的读写控制。
3. 通过外部LED灯的亮灭控制，熟悉树莓派对外界信号的读取与输出。

课程细节
----

本课程将使用以下组件：

*   树莓派
*   LED模块
*   杜邦线

这个教程分为以下任务：

1.  学习实验知识
2.  硬件连接
3.  编写Python程序 led\_blink\_GPIO.py
4.  运行程序，观察效果

准备材料
----

在开始这个教程之前，你需要准备以下材料：

*   一台树莓派
*   一个LED模块
*   几根杜邦线

引言
==

在这个教程中，我们将学习如何使用Python语言编程，通过树莓派上GPIO的控制，周期性地改变外部LED灯的亮灭状态，使之发生周期为一秒的持续明暗闪烁。

整体步骤
----

这个教程将分为以下几个任务：

1.  学习实验知识
2.  硬件连接
3.  编写Python程序 led\_blink\_GPIO.py
4.  运行程序，观察效果

请按照教程中的步骤完成每个任务。

任务1：学习实验知识
----------

### 1. 什么是树莓派？
树莓派（Raspberry Pi）是英国树莓派基金会开发的低成本微型单板计算机，硬件上配置有SoC (片上系统)，具有 GPU和RAM并支持有线、无线连接方案。值得称道的是，树莓派有着完善的社区与软件支持，这极大地方便了机器人开发初学者的入门学习。
树莓派在具备计算机基本功能的同时，保持着一张卡片的大小，这意味着你可以简单便捷地搭建自己的机器人编程平台，并将这台微型计算机部署在小巧可爱的四足机器狗mini pupper上。
![请添加图片描述](https://img-blog.csdnimg.cn/570729ab6b7149d5ba7de76a9a1777d7.png)
**图片1：树莓派4B**
[参考链接：树莓派](https://www.raspberrypi.com/)

### 2. 什么是GPIO？
树莓派上有丰富的接口，这些接口使得树莓派能够方便地与外部设备进行通信及控制，例如USB、CAMERA、GPIO等。
其中的GPIO接口，全称为General Purpose Input Output，意为通用型输入输出口，树莓派上的GPIO接口可以用于输入、输出或其他特殊功能。
通过GPIO，可以让树莓派和不同的外部模块组件进行交互，例如按钮、蜂鸣器、舵机等。


![在这里插入图片描述](https://img-blog.csdnimg.cn/330a44806add457892ece057cb4425b7.png)**图片2：GPIO接口图**
### 3. 树莓派GPIO引脚图
在命令行中查看树莓派GPIO引脚图。

```bash
pinout
#	如果你希望学习在命令行中对GPIO口进行更复杂的操作，可查看课程的进阶参考文档中实例2部分
```
你将会看到
**图片3：pinout指令的输出结果**
[参考链接：树莓派4B引脚图](https://www.raspberrypi.com/documentation/computers/raspberry-pi.html#gpio-and-the-40-pin-header)



### 4. RPi.GPIO库的基本用法
```python
GPIO.setmode(GPIO.BOARD)	#	初始化GPIO引脚编码方式，需放在代码正式开始处
#	GPIO引脚有多种编码方式，比如BCM、wiringPi、BOARD等,方便起见，课程均采用BOARD编码模式
```

```python
GPIO.setup(12, GPIO.OUT)	#	初始化GPIO引脚设置，需放在代码正式开始处
GPIO.setup(12, GPIO.IN)	#	12为引脚号 GPIO.IN或者GPIO.OU为输入输出模式
```

```python
print(GPIO.input(12))	#	GPIO.input查看GPIO输入的电平信号
#	GPIO.HIGH为高电平 ，GPIO.LOW为低电平 也可用于条件判断作其他操作
```

```python
#	GPIO.output向端口发送高低电平信号
GPIO.output(12, GPIO.HIGH)	#	此处以12号端口为例
GPIO.output(12, GPIO.LOW)
```

```python
GPIO.cleanup()	#	在使用完GPIO后要作清理，避免后续引脚被占用
```
[参考链接：Python RPi.GPIO库](https://pypi.org/project/RPi.GPIO/)
[参考链接：GPIO  Input详解](https://sourceforge.net/p/raspberry-gpio-python/wiki/Inputs/)

### 5. mini pupper学习套件-LED模块的使用
mini pupper学习套件中的LED模块自带板载限流电阻，能够保护LED模块。
接线如下：
|引脚|作用|树莓派对应口|
|--|--|--|
| GND |接地 |GND口|
| R |红灯正极 |PWM口|
| G |绿灯正极 |PWM口|
| B |蓝灯正极 |PWM口|

![在这里插入图片描述](https://img-blog.csdnimg.cn/e6f3189c9f844f288c6ab4934fdbd367.jpeg)

**图片3：LED模块**
任务2：硬件连接
--------
1. 将灯的任一正极（R/G/B/Y）接入树莓派上的PWM端口（例如33号端口）
树莓派的GPIO中仅有部分为PWM口，你可以通过查看树莓派GPIO的引脚图来确认哪个端口是PWM端。

2. 将灯的GND端接入树莓派上的GND端口（例如34号端口）
 你可以通过查看树莓派GPIO的引脚图来确认哪个端口是GND端。
 ![在这里插入图片描述](https://img-blog.csdnimg.cn/9f34165bdb654134a620c8a2d8a8e0bb.jpeg)

**图片4：硬件接线**
任务3：编写Python程序 led\_blink\_GPIO.py
----------------------------------

```python
#!/usr/bin/python
# coding:utf-8
# led_blink_GPIO.py
# 使树莓派GPIO外接的LED灯的亮灭状态周期性地改变，发生周期为两秒的持续明暗闪烁。

import RPi.GPIO as GPIO
import time

# GPIO初始化
LED = 33
period = 2
GPIO.setmode(GPIO.BOARD)  # 初始化GPIO引脚编码方式
GPIO.setup(LED, GPIO.OUT)
# 如果你需要忽视引脚复用警告，请调用GPIO.setwarnings(False)
# GPIO.setwarnings(False)
print('预设置完成，开始闪烁，端口为%d，周期为%d秒。' % (LED, period))

while True:
    GPIO.output(LED, GPIO.HIGH)
    time.sleep(period/2)
    GPIO.output(LED, GPIO.LOW)
    time.sleep(period/2)

GPIO.cleanup()
```

任务4：运行程序，观察效果
-------------
在led_blink_GPIO.py的目录下执行以下命令：
```bash
sudo python led_blink_GPIO.py
```
此时应观察到树莓派状态指示灯的亮灭状态周期性地改变，发生周期为一秒的持续明暗闪烁。

**图片5：外部LED持续明暗闪烁**
总结
--

经过本知识点的学习和实验操作，你应该能达到以下水平：

| 知识点 | 内容 | 了解|熟悉|掌握|
|--|--|--|--|--|
树莓派|树莓派的来历、用途及基本硬件性能|&#10004;|||
树莓派|树莓派的GPIO|&#10004;|||
GPIO|RPi.GPIO库的用法||&#10004;||
硬件|mini pupper学习套件的LED模块的使用|||&#10004;|

# 背景信息和资源
本教程基于以下资源编写：
[参考链接：树莓派](https://www.raspberrypi.com/)
[参考链接：树莓派4B引脚图](https://www.raspberrypi.com/documentation/computers/raspberry-pi.html#gpio-and-the-40-pin-header)
[参考链接：Python RPi.GPIO库](https://pypi.org/project/RPi.GPIO/)
[参考链接：GPIO  Input详解](https://sourceforge.net/p/raspberry-gpio-python/wiki/Inputs/)
版权信息：教材尚未完善，此处预留版权信息处理方式
mini pupper相关内容可访问：https://github.com/mangdangroboticsclub
